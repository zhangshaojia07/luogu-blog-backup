# CF1641C Anonymity Is Important

### Preface

感谢这道题成功阻止了我灰号上大分。

### Analysis

为方便，设至少有一个病人的区间为 A 区间，没有病人的为 B 区间。

结论：只有当一段覆盖点 $a$ 的 A 区间中除了 $a$ 其他确定为没病时，$a$ 才能确定有病。

**Proof**

如果 $a$ 不在任意上述类型的 A 区间内，那对于任何覆盖 $a$ 的 A 区间，设定除了已确定没病的人和 $a$ 之外的人全都得病，这样就构造了一个所有条件都满足且 $a$ 没得病的情况（反例），原命题得证。$\blacksquare$

这样的话，若询问 $x$ 的得病状况：

若 $x$ 被 B 区间覆盖（Algorithm 1），输出 NO。

否则，求出最小的 $L$ 使得 $[L,x-1]$ 之间所有人绝对没有得病的，同理求出 $x$ 右边最大的 $R$。（Algorithm 1）

只要判断是否有 A 区间被包含在 $[L,R]$ 即可，因为若有，A 区间必然包含 $x$。（Algorithm 2）

### Algorithm 1

可以 $O(n\log n)$ 用线段树或 `std::set` 维护，但我用了线性均摊做法。（详见代码，类似链表或并查集）

### Algorithm 2

用线段树维护区间最小值。对于每一个 A 区间 $[l,r]$，在 $l$ 位置上标记 $r$。（若同一个 $l$ 有多个 $r$，取最小的）

### Code

[Link](https://codeforces.com/contest/1642/submission/147562428)