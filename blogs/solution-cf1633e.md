# CF1633E Spanning Tree Queries

### Preface

一定要把代码写清楚了！不然赛后订正很痛苦。（我重写了）

赛时写出来但调了一刻钟无果，我选择死亡。

### Analysis

询问 $10^7$，明显回答时间不能超过 $\log$。那我们前期要预处理更多。

发现这是**带绝对值最小生成树**问题。遇到绝对值要分类，但是分成 $m$ 类好像不行……

回顾 Kruskal 的算法过程，发现如果边之间边权的大小关系确定了，那么贪心的排序就可以实现了。而大小关系在 $Q$（询问的数）不同时最多只有 $O(m^2)$ 种不同的边权的大小关系。因为考虑 $Q$ 从 $-\infty$ 到 $\infty$ 的过程，边权 $\le Q$ 的带绝对值边权在递增，而边权 $>Q$ 的递减，只有当 一个边权从 $>Q$ 变为 $\le Q$  或 一个绝对值边权与另一个绝对值边权的大小关系发生变化 时，才会有新的边权的大小关系出现，而 $m$ 个边权里选两个取平均数的规模是 $O(m^2)$ 的。

我们就得到了一些值 $Gap$（按升序排）来划分 $Q$ 的值域，使得 $Q$ 在每一段内时，绝对值边权的大小关系不变。

我们对于每个区间选最大的 $Q$ 为代表值，用她 $|Q-w_i|$ 这样的边权跑 Kruskal，同时记录最小生成树中有多少边本来的边权 $<Q$（在保证生成树最小时尽量使这个值最大，请读者思考）。

当询问时，二分到这段区间，通过代表值的答案来 $O(1)$ 推导答案即可。

时间 $O(m^3\log m\times\alpha(n)+k\log m)$。

### Code

[Link](https://codeforces.com/contest/1633/submission/145942192)