# CF109C Lucky Tree

### Preface

（一开始）哇，树形 DP 解决。

（看难度）哇！好水的紫题。

（写完看题解）哇！我是↑↓。

### Analysis

其实这道题可以用连通块解决，但是树形 DP 更有扩展意义。

设「幸运边」的边权为 $1$，否则为 $0$。

先将树定根，不妨 $\text{root}\!=\!1$。

对于固定的节点 $x$，与她之间路径有「幸运边」的点分成两类：在 $x$ 子树中的和不在的。

子树中的可以用简单的 DP 解决，设个数为 $a_i$。

再来第二遍 DFS，这时将每个节点的「不在这个节点子树内的与她之间有幸运边的点的个数」下传到儿子们，设为 $b_i$。

这样两遍 DFS $O(n)$ 解决问题。

最后答案为

$$\sum\limits_{i=1}^n(a_i+b_i)(a_i+b_i-1)$$

### Code

[Link](https://codeforces.com/contest/109/submission/151200906)