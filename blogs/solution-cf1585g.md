# CF1585G Poachers（长剖/优先队列）

目标是求出每个树根的 sg 函数。

长剖，每个点维护其为根的子树的 sg 值，以及该 sg 值是由哪个集合的值求 $\text{mex}$ 得到的。

对于叶子，sg 值 $=1$，集合为 $\{0\}$。

对于只有一个儿子的节点，其集合为儿子集合加上儿子的 sg（直接换过来，复杂度 $O(1)$），该节点的 sg 若出现在集合中则不断 $+1$。

否则，先执行长剖合并过程，每个位置存该深度子树的 sg 值的 $\text{xor}$ 和。求 sg 时直接暴力存集合求 $\text{mex}$ 。该步复杂度基于最浅叶子深度，由长剖合并复杂度分析，复杂度正确。

用优先队列实现集合的各种操作，总复杂度 $O(n\log n)$。

长剖容易写挂不好调，开内存池的做法很难找出越界错误。