# [AGC059C] GPLP（完全图闭包状物  / 2sat 解计数）

题目转化：

给定一个 $n$ 阶完全图，边权构成了 $1\sim \binom{n}{2}$ 的排列。

问这个图有多少 DAG 定向，使得**每一条** $x\to y$ 边权为 $z$ 的**边**，不存在 $x\to y$ 边权**均小于** $z$ 的**路径**。

* * *

这个限制等价于所有三个点的诱导子图（设 $x\to y,y\to z,x\to z$）有 $x\to y$ 和 $y\to z$ 边权较大值大于 $x\to z$ 的边权。

为啥等价呢？可以用最小矛盾子图 $>3$ 推出矛盾来反证。

所以我们枚举有序点三元组 $(x,y,z)$，若 $(x,y)$ 和 $(x,z)$ 边权均小于 $(y,z)$，则 $(x,y)$ 和 $(x,z)$ 两条边定向时有且仅有一条是指向 $x$ 的。

发现这样的条件顺便满足了 DAG 这个限制，证明可以考虑若有环则最小环长度 $=3$。

所以我们存在多个形如「两条边方向必须相同 / 不同」的条件，就是 2sat 问题了。

这里只要考虑解的个数，所以用带权并查集即可。