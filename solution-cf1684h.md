# CF1684H Hard Cut(结论/构造/分讨)

题意：给定长度 $\le 10^6$ 的 01 串，你需要划分成若干子串，满足每个子串看作二进制数之和为 $2$ 的幂。

* * *

设 $f(x)(x\in\mathbb N^+)$ 为不小于 $x$ 的最小 $2$ 的幂，即 $f(x)=2^{\lceil\log_2 x\rceil}$。

设 $g(x,y)$ 表示用 $x$ 个 `1` 构成的串，划分后和为 $y$ 的构造问题，以及 $g(x)=g(x,f(x))$。

以下约定 $c$ 为正整数。

**结论 A**：对于任意 $c$，$\exists d,g(c,d)$ 有解，且当 $c\ne 5$ 时 $g(c)$ 有解。

以下的构造即为此结论的证明。

尝试解决 $g(c)$，我们尝试分治：将序列分为左右两半使得 `1` 个数尽量相等，分别做 $g(\lfloor\frac{c}{2}\rfloor,\frac{f(c)}{2}),g(\lceil \frac{c}{2}\rceil,\frac{f(c)}{2})$。

这个分治**几乎**是对的，问题有三：

* $c$ 过小无法分治。
* 分治之后不是子问题，即 $f(\lfloor\frac{c}{2}\rfloor)\ne \frac{f(c)}{2}$。
	* 不考虑右半边是因为 $\forall c>1, f(\lceil \frac{c}{2}\rceil)=\frac{f(c)}{2}$。
* 分治之后有 $g(5)$。

对于第一个问题，我们有：

* * *

**结论 B**：对于任意 $c$，$\forall d\in \mathbb Z\cap [c,\frac{3}{2}c],g(c,d)$ 有解。

构造：将相邻的 `1` 两两配对，对于每对都可以：

* 拆成 `1+1`，和为 $2$。
* 拆成 `10+1` 或 `11`（具体看两个 `1` 是否相邻），和为 $3$。

证毕。

* * *

所以我们能直接解决 $\forall c\in [1,4],g(c)$。

接下来第二个问题只考虑 $c>5$ 的情况。

此时 $f(\lfloor\frac{c}{2}\rfloor)\ne \frac{f(c)}{2}\iff\exists k\in\mathbb N,c=2^k+1$。这样我们要解决 $g(2^{k-1},2^k)$，用下方的结论可以轻松解决：

* * *

**结论 C**：$g(4,8)$ 有解。

按最左边的 `1` 出现位置紧跟的两个字符分类：

* `11`：拆成 `111+1`。
* `10`：拆成 `110+1+1`。
* `00`：拆成 `100+` $g(3,4)$，可用结论 B。
* `01`：拆成 `101+` $g(2,3)$，可用结论 B。

证毕。

* * *

接下来只有第三个问题了。

我们先来构造 $c=5$ 的解（此时不能保证和是 $f(5)=8$，有可能是 $16$）。

如果 $5$ 个 `1` 都紧挨，那划分 `1111+1`，和为 $16$。

否则，一定存在 `100` 或 `101` 作为子串，将其划分出来剩下的一位一位划分即可，和为 $8$。

接下来，我们证明 $\forall c\in\{9,10,11\},g(c)$ 有解，就完结撒花了。

$c=10$：重新划分，分成 $g(4,8)$ 和 $g(6)$。

$c=11$：重新划分，分成 $g(4,8)$ 和 $g(7)$。

接下来 $c=9$，类似结论 C 的证明，按第一个 `1` 紧跟的两个字符分类：

* `11`：拆成 `111+` $g(6,9)$，结论B。
* `10`：拆成 `110+` $g(7,10)$，结论B。
* `00`：拆成 `100+` $g(8,12)$，结论B。
* `01`：拆成 `101+` $g(4,8)$ `+` $g(1)$ `+` $g(1)$。

**总结**：

分治时分出 $2$ 的幂要特判。

$c=5$ 害群之马。

结论 B 搞小数据。