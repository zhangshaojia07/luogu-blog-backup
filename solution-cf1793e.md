# CF1793E Velepin and Marketing（单调性/前缀优化DP）

@[陈玉彬](https://www.luogu.com.cn/user/333119) 教的线性做法 orz。

将 $a_1,\dots,a_n$ 非降序排序（桶排序）。

**结论：一定存在最优解使得看同一本书的人都是连续段，而且快乐的人一定是下标的一个前缀，而且要么只有第一个组的前缀快乐要么一个组的快乐状态相同。**

证明可以考虑调整法，但是过于繁琐及套路，这里不再赘述。

所以我们线性预处理出 $f_i$，表示将 $a[1,i]$ 均变为快乐的最多书数量。

对于书数量递增，我们答案一定递减，用一个指针扫。接着就变成单个判定问题：在 $x$ 本书的情况下能否让至少 $y$ 个人快乐。

这个问题可以 $O(1)$ 做：

* 若可以让 $a_1,\dots,a_y$ 看同一本书，即 $x\le n-y+1$，则判定为 $[a_y\le n-x+1]$。
* 否则，$a_1$ 和 $a_y$ 必然不在同一段，判定为 $[f_y+n-y\ge x]$。

总复杂度 $O(n)$，跑了 62ms。